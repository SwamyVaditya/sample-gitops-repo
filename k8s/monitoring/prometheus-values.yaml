# k8s/monitoring/prometheus-values.yaml
# --- CRITICAL CHANGE 1: Prevent the Helm chart from installing CRDs ---
installCRDs: false 
# --------------------------------------------------------------------

# Core Prometheus settings
prometheus:
  prometheusSpec:
    # serviceMonitorSelectorNilUsesHelmValues: false
    # serviceMonitorNamespaceSelector: {}
    # --- CRITICAL FIX 1: Allow Prometheus to find ServiceMonitors in any namespace ---
    serviceMonitorSelectorNilUsesHelmValues: false
    # By setting this empty, Prometheus will look for ServiceMonitors 
    # that match the 'relabeling labels' *globally* across the cluster.
    serviceMonitorNamespaceSelector: {} 
    
    # --- CRITICAL FIX 2: Set the ServiceMonitor label to match the one you are creating. ---
    # The default for the chart is usually 'release: kube-prometheus-stack',
    # but let's ensure it can find *your* ServiceMonitor created by Kustomize.
    serviceMonitorSelector:
      matchLabels:
        release: kube-prometheus-stack
        # Add the app label used on your ServiceMonitor for belt-and-suspenders
        app.kubernetes.io/name: sample-app # Not strictly needed if using release label, but helps.

    service:
      type: ClusterIP
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - prometheus.myapp.localdev.me
    tls:
      - secretName: prometheus-tls
        hosts:
          - prometheus.myapp.localdev.me

# Alertmanager settings
alertmanager:
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - alertmanager.myapp.localdev.me
    tls:
      - secretName: alertmanager-tls
        hosts:
          - alertmanager.myapp.localdev.me

# Grafana settings
grafana:
  adminPassword: admin123

  # Use ClusterIP (not LoadBalancer) for local dev
  service:
    type: ClusterIP

  # Ingress for HTTPS access
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - grafana.myapp.localdev.me
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.myapp.localdev.me


  # Optional: persist dashboards (if you want)
  persistence:
    enabled: false